#summary A description of the PHP files used.

= Introduction =

The following PHP files are used:

 * update.php - Called from the wireless nodes with node data
 * sync.php - Called at regular intervals to update node and link status
 * config.inc.php - Reads the configuration file
 * gObjects.inc.php - A class for reading and updating the gObjects table
 * gLogs.inc.php - A class for adding status changes to the gLogs table
 * gProperties.inc.php - A class for modifying additional properties in the gProperties table

 * gClasses.php - Returns an XML formatted file containing information from the gClasses table
 * gObjects.php - Returns an XML formatted file containing information from the gObjects table
 * gLinks.php - Returns an XML formatted file containing information from the gLinks table
 * gLogs.php - Returns an XML formatted file containing information from the gLogs table
 * gPerformances.php - Returns an XML formatted file containing information from the gPerformances table
 * gProperties.php - Returns an XML formatted file containing information from the gProperties table
 * gStatuses.php - Returns an XML formatted file containing information from the gStatuses table

 * gObjectView.php - A list of all objects
 * gLogView.php - An overview of a specific object
 * SNR.jpgraph.php - A file utilizing JPGraph for generating a report on Quality, Signal and Noise
 * TRX.jpgraph.php - A file utilizing JPGraph for generating a report on transmission data
 * gLogSNR.xml.php - A XML-formatted file containing Quality, Signal and Noise
 * gLogTRX.xml.php - A XML-formatted file containing transmission data

= update.php =

{{{
<?php

require('config.inc.php');

$REMOTE_ADDR=$_SERVER['REMOTE_ADDR'];

$IP=	$_GET['IP'];
$AP=	$_GET['AP'];
$ESSID=	$_GET['ESSID'];
$RATE=	$_GET['RATE'];		if (!$RATE) $RATE=0;
$UPTIME=$_GET['UPTIME'];	if (!$UPTIME) $UPTIME=0;
$CLI=	$_GET['CLI'];		if (!$CLI) $CLI=0;

$dt	=DST();

$q="SELECT * FROM gObjects WHERE MAC='$AP'";
echo "q: ".$q."<br>";
$r=mysql_query($q) or die(mysql_error());
if ($row=mysql_fetch_array($r, MYSQL_ASSOC)) {
	$oid=$row["id"];
} else {
	$oid=0;
}

$t=DST();
if ($oid>0) {
	$q="UPDATE gObjects SET IP='$IP',REMOTE_ADDR='$REMOTE_ADDR',ESSID='$ESSID',RATE=$RATE,UPTIME=$UPTIME,CLI=$CLI,LastContact='$t' WHERE id=$oid";
	echo "q: ".$q."<br>";
	$r=mysql_query($q) or die(mysql_error());
} else {
	$q="INSERT gObjects (MAC,IP,REMOTE_ADDR,ESSID,RATE,UPTIME,CLI,LastContact) VALUES ('$AP','$IP','$REMOTE_ADDR','$ESSID',$RATE,$UPTIME,$CLI,'$t')";
	echo "q: ".$q."<br>";
	$r=mysql_query($q) or die(mysql_error());
	$id=mysql_insert_id();
}

if ($oid>0) {
	$q="UPDATE gProperties SET Value='$ESSID' WHERE refOid=$oid AND Name='ESSID'";
} else {
	$q="INSERT gProperties (refOid,Name,Value) VALUES ($id,'ESSID','$ESSID')";
}
echo "q: ".$q."<br>";
$r=mysql_query($q) or die(mysql_error());

if ($oid>0) {
	$q="UPDATE gProperties SET Value='$RATE' WHERE refOid=$oid AND Name='RATE'";
} else {
	$q="INSERT gProperties (refOid,Name,Value) VALUES ($id,'RATE','$RATE')";
}
echo "q: ".$q."<br>";
$r=mysql_query($q) or die(mysql_error());

if ($oid>0) {
	$q="UPDATE gProperties SET Value='$CLI' WHERE refOid=$oid AND Name='CLI'";
} else {
	$q="INSERT gProperties (refOid,Name,Value) VALUES ($id,'CLI','$CLI')";
}
echo "q: ".$q."<br>";
$r=mysql_query($q) or die(mysql_error());

$RXP=	$_GET['RXP'];	// RX packets
$RXe=	$_GET['RXe'];	// RX errors
$RXd=	$_GET['RXd'];	// RX dropped
$RXo=	$_GET['RXo'];	// RX overruns
$RXf=	$_GET['RXf'];	// RX frames
$RXb=	$_GET['RXb'];	// RX bytes

$TXP=	$_GET['TXP'];	// TX packets
$TXe=	$_GET['TXe'];	// TX errors
$TXd=	$_GET['TXd'];	// TX dropped
$TXo=	$_GET['TXo'];	// TX overruns
$TXc=	$_GET['TXc'];	// TX carriers
$TXco=	$_GET['TXco'];	// TX collisions
$TXq=	$_GET['TXq'];	// TX queue length
$TXb=	$_GET['TXb'];	// TX bytes

$table="gLogTRXDays";
$q="INSERT $table(refOid,Timestamp,RATE,UPTIME,CLI,RXP,RXe,RXd,RXo,RXf,RXb,TXP,TXe,TXd,TXo,TXc,TXco,TXq,TXb) ".
	"VALUES($oid,'$t',$RATE,$UPTIME,$CLI,$RXP,$RXe,$RXd,$RXo,$RXf,$RXb,$TXP,$TXe,$TXd,$TXo,$TXc,$TXco,$TXq,$TXb)";
echo "q: $q<br>";
$r=mysql_query($q) or die(mysql_error());

$MACARR		=$_GET['MAC'];
$SIGARR		=$_GET['SIG'];
$NOISEARR	=$_GET['NOISE'];
$QUALARR	=$_GET['QUAL'];

for ($i=0;$i<count($MACARR);$i++)
{
	$MAC	=$MACARR[$i];
	$SIG	=$SIGARR[$i];
	$NOISE	=$NOISEARR[$i];
	$QUAL	=$QUALARR[$i];

	$q="INSERT gLogDays (refOid,Timestamp,MAC,SIG,NOISE,QUAL) VALUES ($oid,'$t','$MAC',$SIG,$NOISE,'$QUAL')";
	echo "q: $q<br>";
	$r=mysql_query($q) or die(mysql_error());

	$QUAL=$SIG-$NOISE;
	$q="UPDATE gLinks ".
		"SET Signal1='$SIG',Noise1='$NOISE',Quality1='$QUAL' ".
		"WHERE (SELECT id FROM gObjects WHERE MAC='$AP') ".
		"=gLinks.refOid1 ".
		"AND (SELECT id FROM gObjects WHERE MAC='$MAC') ".
		"=gLinks.refOid2";
	echo "q: $q<br>";
	$r=mysql_query($q) or die(mysql_error());
	
	$q="UPDATE gLinks ".
		"SET Signal2='$SIG',Noise2='$NOISE',Quality2='$QUAL' ".
		"WHERE (SELECT id FROM gObjects WHERE MAC='$AP') ".
		"=gLinks.refOid2 ".
		"AND (SELECT id FROM gObjects WHERE MAC='$MAC') ".
		"=gLinks.refOid1";
	echo "q: $q<br>";
	$r=mysql_query($q) or die(mysql_error());
}
}}}